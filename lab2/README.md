# Документация: Просмотрщик информации об изображениях

## Описание

`image_info_viewer.py` — графическое приложение на Python с интерфейсом Tkinter для просмотра и анализа метаданных файлов изображений. Программа позволяет загружать отдельные файлы или целые папки с изображениями и отображает их характеристики в удобной табличной форме.

## Возможности

- **Загрузка изображений**:
  - Выбор отдельных файлов через диалоговое окно
  - Загрузка всех изображений из папки (включая подпапки)
  
- **Отображаемая информация**:
  - Имя файла
  - Размер в пикселях (ширина × высота)
  - Разрешение в DPI (точек на дюйм)
  - Глубина цвета и цветовой режим
  - Тип сжатия

- **Интерфейс**:
  - Табличное представление с возможностью прокрутки
  - Прогресс-бар для отслеживания загрузки
  - Возможность отмены загрузки
  - Строка состояния
  - Многопоточная обработка (интерфейс не блокируется при загрузке)

## Системные требования

### Зависимости

- **Python 3.6+**
- **Tkinter** (обычно входит в стандартную установку Python)
- **Pillow (PIL)** — библиотека для работы с изображениями

### Установка зависимостей

```bash
pip install pillow
pip intall tkinter
```

## Поддерживаемые форматы изображений

Приложение поддерживает маты:

- **BMP** (Bitmap) — `.bmp`следующие фор
- **JPEG** — `.jpg`, `.jpeg`
- **PNG** (Portable Network Graphics) — `.png`
- **GIF** (Graphics Interchange Format) — `.gif`
- **TIFF** (Tagged Image File Format) — `.tiff`, `.tif`

## Использование

### Запуск приложения

```bash
python image_info_viewer.py
```

или

```bash
python3 image_info_viewer.py
```

### Основные операции

#### 1. Выбор отдельных файлов

1. Нажмите кнопку **"Выбрать файлы"**
2. В открывшемся диалоговом окне выберите один или несколько файлов изображений
3. Нажмите **"Открыть"**
4. Информация о выбранных файлах появится в таблице

#### 2. Загрузка папки с изображениями

1. Нажмите кнопку **"Выбрать папку"**
2. Выберите папку, содержащую изображения
3. Приложение автоматически найдет все изображения в папке и подпапках
4. Информация о найденных изображениях отобразится в таблице

#### 3. Очистка таблицы

Нажмите кнопку **"Очистить"** для удаления всех записей из таблицы.

#### 4. Отмена загрузки

Если загрузка большого количества файлов занимает много времени, нажмите кнопку **"Отменить загрузку"** для прерывания процесса.

### Интерпретация результатов

#### Столбцы таблицы

| Столбец | Описание | Пример значения |
|---------|----------|-----------------|
| **Имя файла** | Название файла изображения | `photo.jpg` |
| **Размер (пиксели)** | Ширина и высота в пикселях | `1920 x 1080` |
| **Разрешение (DPI)** | Разрешение по горизонтали и вертикали | `72 x 72` или `Не указано` |
| **Глубина цвета** | Количество бит на пиксель и цветовой режим | `24 бита (RGB)` |
| **Сжатие** | Тип используемого сжатия | `JPEG`, `PNG (deflate)`, `RGB (без сжатия)` |

#### Расшифровка глубины цвета

- **1 бит (монохромное)** — черно-белое изображение, 2 цвета
- **8 бит (градации серого)** — 256 оттенков серого
- **8 бит (палитра)** — до 256 индексированных цветов
- **24 бита (RGB)** — True Color, 16.7 млн цветов
- **32 бита (RGBA)** — RGB с альфа-каналом (прозрачность)
- **32 бита (CMYK)** — цветовая модель для печати

#### Типы сжатия

**Для BMP:**
- `RGB (без сжатия)` — несжатые данные
- `RLE 8-bit` / `RLE 4-bit` — сжатие методом RLE (Run-Length Encoding)
- `Bitfields` — использование битовых масок для цветовых компонентов

**Для других форматов:**
- `JPEG` — сжатие с потерями
- `PNG (deflate)` — сжатие без потерь алгоритмом deflate
- `LZW` — сжатие без потерь (используется в GIF)

## Архитектура приложения

### Структура класса `ImageInfoViewer`

#### Основные методы

##### `__init__(self, root)`
Инициализирует приложение, создает главное окно и элементы интерфейса.

##### `create_widgets(self)`
Создает все элементы пользовательского интерфейса:
- Кнопки управления
- Прогресс-бар
- Таблицу (Treeview)
- Полосы прокрутки
- Строку состояния

##### `select_files(self)`
Открывает диалог выбора файлов и передает выбранные файлы на обработку.

##### `select_folder(self)`
Открывает диалог выбора папки, рекурсивно ищет в ней все изображения и передает их на обработку.

##### `process_files(self, files)`
Запускает обработку списка файлов в отдельном потоке для предотвращения блокировки интерфейса.

##### `_process_files_thread(self, files)`
Выполняется в отдельном потоке. Обрабатывает каждый файл, обновляет прогресс-бар и добавляет данные в таблицу.

##### `get_image_info(self, filepath)`
Извлекает метаданные изображения с помощью библиотеки Pillow:
- Размеры
- DPI
- Цветовой режим
- Тип сжатия

Возвращает кортеж с информацией для отображения в таблице.

##### `clear_table(self)`
Удаляет все записи из таблицы и сбрасывает состояние.

##### `cancel_load(self)`
Устанавливает флаг отмены загрузки, который проверяется в потоке обработки.

#### Вспомогательные методы

##### `_get_bit_depth(self, mode)`
Преобразует режим изображения PIL (например, `RGB`, `RGBA`, `L`) в понятное описание глубины цвета.

##### `_get_bmp_compression(self, comp_code)`
Преобразует числовой код типа сжатия BMP в текстовое описание.

##### `_update_progress(self, progress, current, total)`
Обновляет прогресс-бар и метку с количеством обработанных файлов.

### Многопоточность

Приложение использует модуль `threading` для обработки изображений:

- **Главный поток** — управляет интерфейсом, обрабатывает события
- **Рабочий поток** — обрабатывает файлы изображений

Взаимодействие между потоками осуществляется через метод `root.after()`, который безопасно обновляет элементы интерфейса из рабочего потока.

### Обработка ошибок

При возникновении ошибки чтения файла (поврежденный файл, неподдерживаемый формат и т.д.) приложение:
- Не прерывает обработку остальных файлов
- Отображает информацию об ошибке в соответствующей строке таблицы
- Продолжает обработку следующих файлов

## Примеры использования

### Пример 1: Анализ отдельных изображений

```bash
# Запустить приложение
python image_info_viewer.py

# В интерфейсе:
# 1. Нажать "Выбрать файлы"
# 2. Выбрать нужные изображения
# 3. Изучить информацию в таблице
```

### Пример 2: Массовый анализ папки

```bash
# Запустить приложение
python image_info_viewer.py

# В интерфейсе:
# 1. Нажать "Выбрать папку"
# 2. Выбрать папку test_files/
# 3. Дождаться завершения загрузки
# 4. Просмотреть информацию обо всех изображениях в таблице
```

### Пример 3: Работа с большим количеством файлов

Если вы загружаете большое количество файлов и хотите отменить процесс:

1. Нажмите **"Выбрать папку"** и выберите папку с большим количеством изображений
2. Во время загрузки наблюдайте за прогресс-баром
3. Если нужно прервать процесс, нажмите **"Отменить загрузку"**
4. Уже обработанные файлы останутся в таблице

## Технические детали

### Используемые библиотеки

- **tkinter** — стандартная библиотека для создания GUI
- **ttk** — themed widgets для более современного вида
- **Pillow (PIL)** — мощная библиотека для работы с изображениями
- **threading** — для многопоточной обработки
- **pathlib** — для работы с путями файловой системы

### Производительность

- Обработка выполняется асинхронно, интерфейс остается отзывчивым
- Изображения открываются с помощью контекстного менеджера для автоматического освобождения памяти
- Рекурсивный поиск файлов в папках с использованием `Path.rglob()`

### Ограничения

- Приложение загружает файлы последовательно (по одному за раз)
- Для очень больших изображений (> 100 МП) открытие может занять время
- DPI может отсутствовать в метаданных некоторых изображений
